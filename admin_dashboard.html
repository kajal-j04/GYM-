<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Minnat Vigour Gym</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Material Icons and MDL CSS -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* RESET SOME DEFAULTS */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
    body { background: #f5f5f5; }
    /* SIDEBAR & HEADER */
    .mdl-layout__drawer { width: 240px; background: #1f1f1f; }
    .mdl-layout__drawer .mdl-layout-title { color: #fff; margin-left: 16px; font-size: 18px; line-height: 48px; }
    .mdl-navigation__link { color: #ccc !important; }
    .mdl-navigation__link:hover { background: #333; color: #fff !important; }
    .mdl-layout__header { background: #1f1f1f; color: #fff; }
    .mdl-layout-title { font-size: 20px; }
    /* LOGOUT BUTTON IN HEADER */
    .logout-button { background-color: #ff5722; color: #fff; margin-right: 20px; }
    /* MAIN CONTENT AREA */
    .page-content { padding: 20px; width: 100%; }
    /* HIDING SECTIONS */
    .hidden { display: none; }
    /* LOGIN SECTION */
    .login-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; text-align: center; }
    .login-box { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); width: 300px; }
    .login-box h3 { margin-bottom: 20px; color: #333; }
    .login-box label { display: block; text-align: left; margin-bottom: 5px; font-weight: bold; }
    .login-box input { width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 5px; border: 1px solid #ccc; }
    .login-box button { background: #3f51b5; color: #fff; border: none; width: 100%; padding: 10px; border-radius: 5px; cursor: pointer; }
    .login-box button:hover { background: #303f9f; }
    /* DASHBOARD SECTION */
    .dashboard-container { display: flex; flex-direction: column; gap: 20px; color: #333; }
    .dashboard-header { margin-bottom: 20px; }
    .dashboard-header h3 { font-weight: 400; margin-bottom: 5px; }
    .dashboard-header p { color: #555; }
    .stats-boxes { display: flex; flex-wrap: wrap; gap: 20px; }
    .stats-box { flex: 1; min-width: 180px; background: #fff; border-radius: 8px; padding: 16px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
    .stats-box h4 { margin-bottom: 10px; color: #333; font-weight: 500; }
    .stats-box p { font-size: 24px; font-weight: bold; color: #111; }
    .charts-container { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; }
    .chart-box { flex: 1; min-width: 300px; background: #fff; border-radius: 8px; padding: 16px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
    .chart-box h4 { margin-bottom: 10px; color: #333; }
    canvas { width: 100% !important; max-height: 300px; }
    /* FORMS & TABLES SECTION */
    .form-container { display: flex; flex-direction: column; align-items: center; justify-content: flex-start; min-height: calc(100vh - 64px); text-align: center; padding: 20px; }
    form { display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 500px; padding: 20px; background: #fff; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); margin-bottom: 20px; }
    form label { display: block; text-align: left; font-weight: bold; }
    input, button { padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
    button { background-color: #3f51b5; color: white; border: none; cursor: pointer; transition: background 0.3s; }
    button:hover { background-color: #303f9f; }
    .list-container { margin: 20px auto; padding: 15px; background: #fff; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); width: 100%; max-width: 700px; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 10px; text-align: center; }
    /* Make the list headings clickable */
    h4.section-heading.clickable { cursor: pointer; text-decoration: underline; }
  </style>
</head>
<body>
  <!-- LOGIN SECTION -->
  <div id="login" class="login-container">
    <div class="login-box">
      <h3>Admin login here</h3>
      <form id="loginForm">
        <label for="username">Username</label>
        <input type="text" id="username" placeholder="Username" required>
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit">Login</button>
      </form>
    </div>
  </div>

  <!-- MAIN APP LAYOUT -->
  <div id="appLayout" class="mdl-layout mdl-js-layout mdl-layout--fixed-drawer mdl-layout--fixed-header hidden">
    <!-- HEADER -->
    <header class="mdl-layout__header">
      <div class="mdl-layout__header-row">
        <span class="mdl-layout-title">Minnat Vigour Gym</span>
        <div class="mdl-layout-spacer"></div>
        <button class="mdl-button mdl-js-button mdl-button--raised logout-button" onclick="logoutUser()">LOGOUT</button>
      </div>
    </header>
    <!-- NAV DRAWER -->
    <div class="mdl-layout__drawer">
      <span class="mdl-layout-title">Navigation</span>
      <nav class="mdl-navigation">
        <a href="#" class="mdl-navigation__link" onclick="loadContent('Dashboard')">
          <i class="material-icons">dashboard</i> Dashboard
        </a>
        <a href="#" class="mdl-navigation__link" onclick="loadContent('trainer')">
          <i class="material-icons">fitness_center</i> Trainer
        </a>
        <a href="#" class="mdl-navigation__link" onclick="loadContent('member')">
          <i class="material-icons">people</i> Member
        </a>
        <a href="#" class="mdl-navigation__link" onclick="loadContent('package')">
          <i class="material-icons">inventory_2</i> Package
        </a>
        <a href="#" class="mdl-navigation__link" onclick="loadContent('equipment')">
          <i class="material-icons">build</i> Equipment
        </a>
      </nav>
    </div>
    <!-- MAIN CONTENT -->
    <main class="mdl-layout__content">
      <div id="content-area" class="form-container">
        <!-- Loaded Content Goes Here -->
      </div>
    </main>
  </div>

  <!-- DASHBOARD SECTION -->
  <div id="Dashboard" class="hidden page-content">
    <div class="dashboard-container">
      <div class="dashboard-header">
        <h3>Hello Admin</h3>
        <p>Welcome to your admin dashboard!</p>
      </div>
      <div class="stats-boxes">
        <div class="stats-box">
          <h4>Number of Members</h4>
          <p id="dashMembers">0</p>
        </div>
        <div class="stats-box">
          <h4>Number of Equipments</h4>
          <p id="dashEquipment">0</p>
        </div>
        <div class="stats-box">
          <h4>Number of Packages</h4>
          <p id="dashPackages">0</p>
        </div>
      </div>
      <div class="charts-container">
        <div class="chart-box">
          <h4>Attendance Reports</h4>
          <canvas id="attendanceChart"></canvas>
        </div>
        <div class="chart-box">
          <h4>Total Reports</h4>
          <canvas id="totalReportsChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- TRAINER SECTION -->
  <div id="trainer" class="hidden">
    <h4 class="section-heading">Add Trainer</h4>
    <form id="trainerForm" enctype="multipart/form-data">
      <label for="trainerName">Trainer Name</label>
      <input type="text" id="trainerName" name="trainerName" placeholder="Trainer Name" required>
      <label for="trainerEmail">Email</label>
      <input type="email" id="trainerEmail" name="trainerEmail" placeholder="Email" required>
      <label for="trainerSpecialization">Specialization</label>
      <input type="text" id="trainerSpecialization" name="trainerSpecialization" placeholder="Specialization" required>
      <label for="trainerPhone">Phone Number</label>
      <input type="text" id="trainerPhone" name="trainerPhone" placeholder="Phone Number" required>
      <label for="trainerExperience">Years of Experience</label>
      <input type="text" id="trainerExperience" name="trainerExperience" placeholder="Years of Experience" required>
      <label for="trainerImage">Upload Image</label>
      <input type="file" id="trainerImage" name="trainerImage" accept="image/*" required>
      <button type="submit">Submit</button>
    </form>
    <!-- Clickable list heading -->
    <h4 id="trainerListHeading" class="section-heading clickable">Trainer List (Click to Load)</h4>
    <div class="list-container">
      <table id="trainerTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Specialization</th>
            <th>Phone</th>
            <th>Experience</th>
            <th>Image</th>
          </tr>
        </thead>
        <tbody id="trainerTableBody">
          <tr><td colspan="6">No trainers added yet.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- MEMBER SECTION -->
  <div id="member" class="hidden">
    <h4 class="section-heading">Add Member</h4>
    <form id="memberForm" enctype="multipart/form-data">
      <label for="memberName">Full Name</label>
      <input type="text" id="memberName" name="memberName" placeholder="Full Name" required>
      <label for="memberEmail">Email Address</label>
      <input type="email" id="memberEmail" name="memberEmail" placeholder="Email Address" required>
      <label for="memberPhone">Phone Number</label>
      <input type="text" id="memberPhone" name="memberPhone" placeholder="Phone Number" required>
      <label for="memberGender">Gender</label>
      <input type="text" id="memberGender" name="memberGender" placeholder="Gender" required>
      <label for="memberDOB">Date of Birth</label>
      <input type="date" id="memberDOB" name="memberDOB" required>
      <label for="memberAddress">Address</label>
      <input type="text" id="memberAddress" name="memberAddress" placeholder="Address">
      <label for="memberImage">Upload Image</label>
      <input type="file" id="memberImage" name="memberImage" accept="image/*">
      <button type="submit">Submit</button>
    </form>
    <!-- Clickable list heading -->
    <h4 id="memberListHeading" class="section-heading clickable">Member List (Click to Load)</h4>
    <div class="list-container">
      <table id="memberTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Gender</th>
            <th>Date of Birth</th>
            <th>Address</th>
            <th>Image</th>
          </tr>
        </thead>
        <tbody id="memberTableBody">
          <tr><td colspan="7">No members added yet.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- PACKAGE SECTION -->
  <div id="package" class="hidden">
    <h4 class="section-heading">Add Package</h4>
    <form id="packageForm" enctype="multipart/form-data">
      <label for="packageName">Package Name</label>
      <input type="text" id="packageName" name="packageName" placeholder="Package Name" required>
      <label for="packageDuration">Duration (in months)</label>
      <input type="text" id="packageDuration" name="packageDuration" placeholder="Duration (in months)" required>
      <label for="packagePrice">Price</label>
      <input type="number" id="packagePrice" name="packagePrice" placeholder="Price" required>
      <label for="packageFeatures">Features</label>
      <input type="text" id="packageFeatures" name="packageFeatures" placeholder="Features">
      <label for="packageImage">Upload Image</label>
      <input type="file" id="packageImage" name="packageImage" accept="image/*">
      <button type="submit">Submit</button>
    </form>
    <!-- Clickable list heading -->
    <h4 id="packageListHeading" class="section-heading clickable">Package List (Click to Load)</h4>
    <div class="list-container">
      <table id="packageTable">
        <thead>
          <tr>
            <th>Package Name</th>
            <th>Duration</th>
            <th>Price</th>
            <th>Features</th>
            <th>Image</th>
          </tr>
        </thead>
        <tbody id="packageTableBody">
          <tr><td colspan="5">No packages added yet.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- EQUIPMENT SECTION -->
  <div id="equipment" class="hidden">
    <h4 class="section-heading">Add Equipment</h4>
    <form id="equipmentForm" enctype="multipart/form-data">
      <label for="equipmentName">Equipment Name</label>
      <input type="text" id="equipmentName" name="equipmentName" placeholder="Equipment Name" required>
      <label for="equipmentBrand">Brand</label>
      <input type="text" id="equipmentBrand" name="equipmentBrand" placeholder="Brand" required>
      <label for="equipmentType">Type</label>
      <input type="text" id="equipmentType" name="equipmentType" placeholder="Type" required>
      <label for="equipmentCount">Number of Items</label>
      <input type="number" id="equipmentCount" name="equipmentCount" placeholder="Number of Items" required>
      <label for="equipmentImage">Upload Image</label>
      <input type="file" id="equipmentImage" name="equipmentImage" accept="image/*">
      <button type="submit">Submit</button>
    </form>
    <!-- Clickable list heading -->
    <h4 id="equipmentListHeading" class="section-heading clickable">Equipment List (Click to Load)</h4>
    <div class="list-container">
      <table id="equipmentTable">
        <thead>
          <tr>
            <th>Equipment Name</th>
            <th>Brand</th>
            <th>Type</th>
            <th>Count</th>
            <th>Image</th>
          </tr>
        </thead>
        <tbody id="equipmentTableBody">
          <tr><td colspan="5">No equipments added yet.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // --------------------
    // LOGIN HANDLER
    // --------------------
    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      fetch('http://localhost:3000/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      })
      .then(res => {
        if (!res.ok) throw new Error('Login failed');
        return res.json();
      })
      .then(data => {
        if(data.success) {
          // Remember login state in localStorage
          localStorage.setItem('loggedIn', 'true');
          document.getElementById('login').classList.add('hidden');
          document.getElementById('appLayout').classList.remove('hidden');
          loadContent('Dashboard');
          alert('Logged in successfully!');
        }
      })
      .catch(err => alert(err.message));
    });

    // --------------------
    // LOGOUT FUNCTION
    // --------------------
    function logoutUser() {
      const now = new Date().toLocaleString();
      alert(`You have been logged out at: ${now}`);
      localStorage.removeItem('loggedIn');
      document.getElementById('appLayout').classList.add('hidden');
      document.getElementById('login').classList.remove('hidden');
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
    }

    // --------------------
    // LOAD CONTENT & DASHBOARD FUNCTIONS
    // --------------------
    function loadContent(page) {
      document.getElementById('content-area').innerHTML = document.getElementById(page).innerHTML;
      if(page === 'Dashboard') {
        initCharts();
        updateDashboardCounts();
      }
      attachFormHandlers(); // Attach handlers to dynamically loaded forms and clickable headings
    }

    // Update dashboard counts by fetching actual data
    function updateDashboardCounts() {
      fetch('http://localhost:3000/api/members')
        .then(res => res.json())
        .then(data => {
          document.getElementById('dashMembers').textContent = data.length;
        })
        .catch(() => document.getElementById('dashMembers').textContent = 0);

      fetch('http://localhost:3000/api/equipments')
        .then(res => res.json())
        .then(data => {
          document.getElementById('dashEquipment').textContent = data.length;
        })
        .catch(() => document.getElementById('dashEquipment').textContent = 0);

      fetch('http://localhost:3000/api/packages')
        .then(res => res.json())
        .then(data => {
          document.getElementById('dashPackages').textContent = data.length;
        })
        .catch(() => document.getElementById('dashPackages').textContent = 0);
    }

    // --------------------
    // CHARTS
    // --------------------
    let attendanceChart, totalReportsChart;
    function initCharts() {
      const attCtx = document.getElementById('attendanceChart');
      if (!attCtx) return;
      if (attendanceChart) attendanceChart.destroy();
      attendanceChart = new Chart(attCtx, {
        type: 'bar',
        data: {
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
          datasets: [{
            label: 'Last Week Report',
            data: [12, 19, 3, 5, 2, 3],
            backgroundColor: '#2196f3'
          }]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });

      const totalCtx = document.getElementById('totalReportsChart');
      if (!totalCtx) return;
      if (totalReportsChart) totalReportsChart.destroy();
      totalReportsChart = new Chart(totalCtx, {
        type: 'pie',
        data: {
          labels: ['Packages', 'Members', 'Equipments'],
          datasets: [{
            data: [3, 6, 2],
            backgroundColor: ['#4caf50', '#ff9800', '#9c27b0']
          }]
        },
        options: { responsive: true }
      });
    }

    // --------------------
    // FORM HANDLERS AND CLICKABLE List Headings
    // --------------------
    function attachFormHandlers() {
      // Trainer Form Submission
      const trainerForm = document.getElementById('trainerForm');
      if (trainerForm) {
        trainerForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(trainerForm);
          fetch('http://localhost:3000/api/trainers', {
            method: 'POST',
            body: formData
          })
          .then(res => res.json())
          .then(data => {
            if(data.success) {
              alert('Trainer added successfully!');
              trainerForm.reset();
              fetchTrainers();
            } else {
              alert('Error adding trainer.');
            }
          })
          .catch(err => alert(err.message));
        });
      }

      // Member Form Submission
      const memberForm = document.getElementById('memberForm');
      if (memberForm) {
        memberForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(memberForm);
          fetch('http://localhost:3000/api/members', {
            method: 'POST',
            body: formData
          })
          .then(res => res.json())
          .then(data => {
            if(data.success) {
              alert('Member added successfully!');
              memberForm.reset();
              fetchMembers();
            } else {
              alert('Error adding member.');
            }
          })
          .catch(err => alert(err.message));
        });
      }

      // Package Form Submission
      const packageForm = document.getElementById('packageForm');
      if (packageForm) {
        packageForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(packageForm);
          fetch('http://localhost:3000/api/packages', {
            method: 'POST',
            body: formData
          })
          .then(res => res.json())
          .then(data => {
            if(data.success) {
              alert('Package added successfully!');
              packageForm.reset();
              fetchPackages();
            } else {
              alert('Error adding package.');
            }
          })
          .catch(err => alert(err.message));
        });
      }

      // Equipment Form Submission
      const equipmentForm = document.getElementById('equipmentForm');
      if (equipmentForm) {
        equipmentForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(equipmentForm);
          fetch('http://localhost:3000/api/equipments', {
            method: 'POST',
            body: formData
          })
          .then(res => res.json())
          .then(data => {
            if(data.success) {
              alert('Equipment added successfully!');
              equipmentForm.reset();
              fetchEquipment();
            } else {
              alert('Error adding equipment.');
            }
          })
          .catch(err => alert(err.message));
        });
      }

      // Clickable headings to load lists
      const trainerListHeading = document.getElementById('trainerListHeading');
      if(trainerListHeading) {
        trainerListHeading.addEventListener('click', fetchTrainers);
      }

      const memberListHeading = document.getElementById('memberListHeading');
      if(memberListHeading) {
        memberListHeading.addEventListener('click', fetchMembers);
      }

      const packageListHeading = document.getElementById('packageListHeading');
      if(packageListHeading) {
        packageListHeading.addEventListener('click', fetchPackages);
      }

      const equipmentListHeading = document.getElementById('equipmentListHeading');
      if(equipmentListHeading) {
        equipmentListHeading.addEventListener('click', fetchEquipment);
      }
    }

    // Functions to fetch lists from server and populate tables
    function fetchTrainers() {
      fetch('http://localhost:3000/api/trainers')
      .then(res => res.json())
      .then(data => {
        const tbody = document.getElementById('trainerTableBody');
        tbody.innerHTML = '';
        if(data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6">No trainers added yet.</td></tr>';
        } else {
          data.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${item.name}</td>
                             <td>${item.email}</td>
                             <td>${item.specialization}</td>
                             <td>${item.phone}</td>
                             <td>${item.experience}</td>
                             <td>${item.imageName}</td>`;
            tbody.appendChild(row);
          });
        }
        updateDashboardCounts();
      })
      .catch(err => alert(err.message));
    }

    function fetchMembers() {
      fetch('http://localhost:3000/api/members')
      .then(res => res.json())
      .then(data => {
        const tbody = document.getElementById('memberTableBody');
        tbody.innerHTML = '';
        if(data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7">No members added yet.</td></tr>';
        } else {
          data.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${item.name}</td>
                             <td>${item.email}</td>
                             <td>${item.phone}</td>
                             <td>${item.gender}</td>
                             <td>${new Date(item.dob).toLocaleDateString()}</td>
                             <td>${item.address}</td>
                             <td>${item.imageName || 'No image'}</td>`;
            tbody.appendChild(row);
          });
        }
        updateDashboardCounts();
      })
      .catch(err => alert(err.message));
    }

    function fetchPackages() {
      fetch('http://localhost:3000/api/packages')
      .then(res => res.json())
      .then(data => {
        const tbody = document.getElementById('packageTableBody');
        tbody.innerHTML = '';
        if(data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5">No packages added yet.</td></tr>';
        } else {
          data.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${item.name}</td>
                             <td>${item.duration}</td>
                             <td>${item.price}</td>
                             <td>${item.features}</td>
                             <td>${item.imageName || 'No image'}</td>`;
            tbody.appendChild(row);
          });
        }
        updateDashboardCounts();
      })
      .catch(err => alert(err.message));
    }

    function fetchEquipment() {
      fetch('http://localhost:3000/api/equipments')
      .then(res => res.json())
      .then(data => {
        const tbody = document.getElementById('equipmentTableBody');
        tbody.innerHTML = '';
        if(data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5">No equipments added yet.</td></tr>';
        } else {
          data.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${item.name}</td>
                             <td>${item.brand}</td>
                             <td>${item.type}</td>
                             <td>${item.count}</td>
                             <td>${item.imageName || 'No image'}</td>`;
            tbody.appendChild(row);
          });
        }
        updateDashboardCounts();
      })
      .catch(err => alert(err.message));
    }

    // On page load, check login state and show appropriate layout
    window.onload = function() {
      if(localStorage.getItem('loggedIn') === 'true') {
        document.getElementById('login').classList.add('hidden');
        document.getElementById('appLayout').classList.remove('hidden');
        loadContent('Dashboard');
      } else {
        document.getElementById('login').classList.remove('hidden');
        document.getElementById('appLayout').classList.add('hidden');
      }
    }
  </script>
</body>
</html>
